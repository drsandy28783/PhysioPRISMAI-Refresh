{% extends "base.html" %}
{% block title %}Clinical Flags ‚Äì Physiologic PRISM{% endblock %}
{% block head %}
<style>
  .field-block { margin-top:20px; position:relative; }
  .ai-btn { background:none; border:none; cursor:pointer; font-size:1.2em; flex-shrink:0; margin-top:0.5rem; }
  .ai-hint { display:none; margin-top:8px; padding:8px; background:#fafafa; border-left:4px solid #7cb342; }
  .highlight { background: rgba(124,179,66,0.1); }
  .control-group { display:flex; align-items:flex-start; gap:8px; }
  .control-group .input-field { flex:1; }
</style>
{% endblock %}

{% block content %}
<div class="container">
  <h2>Clinical Flags for {{ patient_id }}</h2>
  <form id="clinical-flags-form" method="POST"
        action="{{ url_for('clinical_flags', patient_id=patient_id) }}">
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

    {% set flags = [
      ['red_flags',    'Red Flags',    'Any red-flag symptoms or history‚Ä¶'],
      ['yellow_flags', 'Yellow Flags (Psychosocial)', 'Any psychosocial risk factors‚Ä¶'],
      ['black_flags',  'Black Flags (Systems/Environment)', 'Any workplace or system-level barriers‚Ä¶'],
      ['blue_flags',   'Blue Flags (Work-Related)', 'Any work-related attitudes or demands‚Ä¶']
    ] %}

    {% for name, label, placeholder in flags %}
      <div class="field-block" id="{{ name }}_block">
        <label for="{{ name }}">{{ label }}</label>
        <div class="control-group">
          <textarea id="{{ name }}" name="{{ name }}"
                    class="input-field" rows="3"
                    placeholder="{{ placeholder }}" data-voice-enabled>{{ request.form[name] or '' }}</textarea>
          <button type="button" class="ai-btn" title="Ask AI follow-up"
                  data-field="{{ name }}">üß†</button>
        </div>
        <div id="{{ name }}_hint" class="ai-hint"></div>
      </div>
    {% endfor %}

    <div style="margin-top:24px; display:flex; gap:12px;">
      <button type="submit" class="button">Save &amp; Continue</button>
      <a href="{{ url_for('chronic_disease',patient_id=patient_id) }}"
         class="button" style="background:#ccc;color:#000;">‚Üê Back</a>
    </div>
  </form>
</div>

<script nonce="{{ csp_nonce() }}">
  // Make patient_id available globally for AI suggestions
  window.currentPatientId = '{{ patient_id }}';
</script>
{% endblock %}
